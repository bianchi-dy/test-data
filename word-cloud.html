<!-- adapted from https://d3-graph-gallery.com/graph/wordcloud_size.html -->
<!DOCTYPE html>
<meta charset="utf-8">

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v6.js"></script>

<!-- Load d3-cloud -->
<script src="https://cdn.jsdelivr.net/gh/holtzy/D3-graph-gallery@master/LIB/d3.layout.cloud.js"></script>

<!-- Create a div where the graph will take place -->
<div id="wordcloud"></div>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk&display=swap');
</style>
<script type="text/javascript">
  // responsivefy function
  function responsivefy(svg) {
    const container = d3.select(svg.node().parentNode),
          width = parseInt(svg.style('width'), 10),
          height = parseInt(svg.style('height'), 10),
          aspect = width / height;
    svg.attr('viewBox', `0 0 ${width} ${height}`)
      .attr('preserveAspectRatio', 'xMinYMid')
      .call(resize);
    d3.select(window).on(
      'resize.' + container.attr('id'),
      resize
    );
    function resize() {
      const w = parseInt(container.style('width'));
      svg.attr('width', w);
      svg.attr('height', Math.round(w / aspect));
    }
  }

  // Dimensions change based on window size
  let innerHeight = window.innerHeight;
  let chartMargin, chartConfig, chartSettings;
  if (window.innerWidth <= 1024) {
    // mobile
    chartMargin = { top: 10, right: 10, bottom: 10, left: 100 };
    chartConfig = {radius: 0.6, separation: 1, shape: Math.PI, barWidth: 0.03, fontsize: 16, barscale: 200};

  } else {
    // desktop
    chartMargin = { top: 20, right: 20, bottom: 20, left: 20 };
    chartConfig = {radius: 0.3, separation: 2, shape: Math.PI * 2, barWidth: 0.03, fontsize: 12, barscale: 180};
  }

  chartSettings = {
    width: innerWidth + chartMargin.left + chartMargin.right,
    height: innerHeight + chartMargin.top + chartMargin.bottom,
  };


  // append the svg object to the body of the page
  var svg = d3.select("#wordcloud").attr("style", "background-color:#23548A;").append("svg")
      .attr("width", chartSettings.width - chartMargin.left - chartMargin.right)
      .attr("height", chartSettings.height - chartMargin.top - chartMargin.bottom)
    .append("g")
      .attr("transform",
            "translate(" + chartMargin.left + "," + chartMargin.top + ")");

  // List of words
  // var myWords = [{word: "Running", size: "10"}, {word: "Surfing", size: "20"}, {word: "Climbing", size: "50"}, {word: "Kiting", size: "30"}, {word: "Sailing", size: "20"}, {word: "Snowboarding", size: "60"} ]
  var myWords = d3.csv("https://raw.githubusercontent.com/bianchi-dy/test-data/main/signals.csv").then(data =>
  {
    let words = [];
    data.map(d => words.push({word: d['Signals'], size: parseInt(d['Count'])}));

    // Constructs a new cloud layout instance. It run an algorithm to find the position of words that suits your requirements
    // Wordcloud features that are different from one word to the other must be here
    var layout = d3.layout.cloud()
      .size([chartSettings.width, chartSettings.height])
      .words(words.map(function(d) { return {text: d.word, size:d.size}; }))
      .padding(5)        //space between words
      .rotate(function() { return ~~(Math.random() * 2) * 0; })
      .fontSize(function(d) { return d.size; })      // font size of words
      .on("end", draw);
    layout.start();

    // This function takes the output of 'layout' above and draw the words
    // Wordcloud features that are THE SAME from one word to the other can be here
    function draw(words) {
      var defs = svg.append("defs");

      var gradient = defs.append("linearGradient")
          .attr("id", "svgGradient")
          .attr("x1", "0%")
          .attr("x2", "0%")
          .attr("y1", "0%")
          .attr("y2", "100%");

      gradient.append("stop")
      .attr("class", "start")
      .attr("offset", "0%")
      .attr("stop-color", "#6B6397")
      .attr("stop-opacity", 1);

      gradient.append("stop")
      .attr("class", "end")
      .attr("offset", "100%")
      .attr("stop-color", "#D8DCC4")
      .attr("stop-opacity", 1);

      svg
        .append("g")
          .attr("transform", "translate(" + layout.size()[0] / 2 + "," + layout.size()[1] / 2 + ")")
          .selectAll("text")
            .data(words)
          .enter().append("text")
            .style("font-size", function(d) { return d.size; })
            .style("fill", "url(#svgGradient)")
            .attr("text-anchor", "middle")
            .style("font-family", "Space Grotesk")
            .attr("transform", function(d) {
              return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
            })
            .text(function(d) { return d.text; });
    }
  });
  // // set the dimensions and margins of the graph
  // var margin = {top: 10, right: 10, bottom: 10, left: 10},
  //     width = 450 - margin.left - margin.right,
  //     height = 450 - margin.top - margin.bottom;



  </script>